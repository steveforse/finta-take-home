<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">Manage Categories</h1>
    <%= link_to "â† Back to Transactions", transactions_path, class: "btn btn-outline-secondary" %>
  </div>

  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="row">
    <!-- Add New Category -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Add New Category</h5>
          <%= form_with model: @category, url: categories_path, class: "mt-3" do |f| %>
            <% if @category.errors.any? %>
              <div class="alert alert-danger">
                <h6>Please fix the following errors:</h6>
                <ul class="mb-0">
                  <% @category.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="mb-3">
              <%= f.label :category_group_id, "Category Group", class: "form-label" %>
              <%= f.select :category_group_id,
                  options_for_select(
                    @category_groups.map { |cg| [cg.name, cg.id] },
                    @category.category_group_id
                  ),
                  { prompt: "Select a group" },
                  class: "form-select" %>
            </div>

            <div class="mb-3">
              <%= f.label :name, "Category Name", class: "form-label" %>
              <%= f.text_field :name, class: "form-control", placeholder: "e.g., Entertainment" %>
            </div>

            <%= f.submit "Create Category", class: "btn btn-primary w-100" %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Existing Categories -->
    <div class="col-md-8">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Existing Categories</h5>

          <% @category_groups.each do |group| %>
            <div class="mb-4">
              <h6 class="text-primary border-bottom pb-2">
                <%= group.name %>
                <span class="badge bg-secondary"><%= group.categories.count %></span>
              </h6>

              <% if group.categories.any? %>
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-2">
                  <% group.categories.each do |category| %>
                    <div class="col">
                      <div class="card h-100">
                        <div class="card-body py-2 px-3">
                          <div class="d-flex justify-content-between align-items-center">
                            <span><%= category.name %></span>
                            <span class="badge bg-light text-dark">
                              <%= category.account_transactions.count %>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% else %>
                <p class="text-muted mb-0">No categories in this group yet.</p>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
